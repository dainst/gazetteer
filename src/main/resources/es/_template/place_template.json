{
    "template" : "gazetteer*",
    "settings" : {
        "analysis": {
            "analyzer" : {
            	"default": {
            		"tokenizer" : "standard",
                    "filter" : ["standard", "folding"]
            	},
            	"raw": {
            		"tokenizer": "keyword",
            		"filter": ["lowercase"]
            	},
                "collation" : {
                    "tokenizer" : "keyword",
                    "filter" : ["collation_filter"]
                },
                "autocomplete": {
          			"type": "custom",
          			"tokenizer": "ngramTokenizer",
          			"filter" :["lowercase", "folding"]
          		} 
            },
            "tokenizer" : {
            	"ngramTokenizer" : {
                	"type" : "edgeNGram",
                    "min_gram" : "2",
                    "max_gram" : "50",
                    "token_chars": []
				}
			},
            "filter" : {
                "collation_filter" : {
                    "type" : "icu_collation",
                    "language" : "de",
                    "numeric" : true
                },
                "lowercase" : {
                	"type" : "lowercase"
                },
                "folding": {
                	"type": "icu_folding",
                	"unicodeSetFilter": "[^äöüÄÖÜß]"
                }
            }
        }
    },
    "mappings" : {
	    "place": {
	    	"_all": {
	    		"omit_norms": true
	    	},
	        "properties": {
	            "prefName": {
	                "properties": {
	                    "language": {
	                        "type": "string",
	                        "include_in_all": false
	                    },
	                    "modern": {
	                        "type": "boolean",
	                        "include_in_all": false
	                    },
	                    "ordering": {
	                    	"type": "string",
	                    	"include_in_all": false
	                    },
	                    "title": {
	                        "type": "string",
							"omit_norms": true,
							"fields": {
								"raw": {
									"type": "string",
									"analyzer": "raw"
								},
	                    		"sort": {
									"type": "string",
									"analyzer": "collation"
								},
								"suggest": {
									"type": "completion",
									"analyzer": "default"
								},
								"autocomplete": {
									"type": "string",
									"analyzer": "autocomplete"
								}
							}   
						}
	                }
	            },
	            "names": {
	            	"type": "nested",
					"include_in_parent": true,
	                "properties": {
	                    "language": {
	                        "type": "string",
							"include_in_all": false
	                    },
	                    "modern": {
	                        "type": "boolean",
							"include_in_all": false
	                    },
	                    "ordering": {
	                    	"type": "string",
	                    	"include_in_all": false
	                    },
	                    "title": {
	                        "type": "string",
							"omit_norms": true,
							"fields": {
								"raw": {
									"type": "string",
									"analyzer": "raw"
								},
	                    		"sort" : {
									"type": "string",
									"analyzer": "collation"
								},
								"suggest" : {
									"type": "completion",
									"analyzer": "default"
								},
								"autocomplete": {
									"type": "string",
									"analyzer": "autocomplete"
								}
							}
	                    }
	                }
	            },
	            "suggestionNames": {
					"type": "string",
					"fields": {
						"raw": {
							"type": "string",
							"analyzer": "raw"
						},
						"suggest" : {
							"type": "completion",
							"analyzer": "default",
							"context": {
								"recordGroupId": {
									"type": "category",
									"path": "recordGroupId",
									"default": "none"
								}
							}
						}
	            	},
					"include_in_all": false
	            },
	            "prefLocation": {
	            	"properties": {
	                    "confidence": {
	                        "type": "long",
							"include_in_all": false
	                    },
	                    "coordinates": {
	                        "type": "geo_point",
							"include_in_all": false
						},
						"altitude": {
	            			"type": "double",
	            			"include_in_all": false
	            		},
						"shape": {
							"type": "geo_shape",
							"include_in_all": false
						}
	                }
	            },
	            "locations": {
	            	"type": "nested",
	                "properties": {
	                    "confidence": {
	                        "type": "long",
							"include_in_all": false
	                    },
	                    "coordinates": {
	                        "type": "geo_point",
							"include_in_all": false
						},
						"altitude": {
	            			"type": "double",
	            			"include_in_all": false
	            		},
						"shape": {
							"type": "geo_shape",
							"include_in_all": false
						}
	                }
	            },
	            "children": {
	                "type": "integer",
					"include_in_all": false
	            },
	            "deleted": {
	                "type": "boolean"
	            },
	            "ids": {
	            	"type": "nested",
	                "properties": {
	                    "context": {
	                        "type": "string",
							"index": "not_analyzed",
							"include_in_all": false
	                    },
	                    "value": {
	                        "type": "string",
	                        "index": "not_analyzed"
	                    }
	                }
	            },
	            "links": {
	            	"type": "nested",
	                "properties": {
	                    "object": {
	                        "type": "string",
							"index": "not_analyzed"
	                    },
	                    "predicate": {
	                        "type": "string",
							"index": "not_analyzed",
							"include_in_all": false
	                    },
	                    "description": {
	                    	"type": "string",
	                    	"index": "not_analyzed"
	                    }
	                }
	            },
	            "needsReview": {
	                "type": "boolean"
	            },
	            "parent": {
	                "type": "string",
					"include_in_all": false
	            },
	            "ancestors": {
					"type": "string",
					"include_in_all": false
	            },
	            "relatedPlaces": {
	            	"type": "string"
	            },
	            "types": {
	                "type": "string",
	                "index": "not_analyzed"
				},
				"tags": {
					"type": "string",
					"index": "not_analyzed",
					"fields": {
	               		"suggest" : {
							"type": "completion"
						}
					}
				},
				"provenance": {
					"type": "string",
					"fields": {
	               		"suggest" : {
							"type": "completion"
						}
					}
				},
				"groupInternalData": {
					"type": "nested",
					"properties": {
						"text": {
							"type": "string",
							"include_in_all": false
						},
						"groupId": {
							"type": "string",
							"include_in_all": false
						}
					}
				},
				"recordGroupId": {
					"type": "string",
					"include_in_all": false
				},
				"lastChangeDate": {
					"type": "date",
					"include_in_all": false
				},
	            "_class": {
	                "type": "string",
					"include_in_all": false
	            }
	        },
			"transform" : {
				"script": "ctx._source.suggestionNames = []; if (ctx._source['deleted'] == true) { ctx._source['prefName'] = null; ctx._source['names'] = null; } else { if (ctx._source['prefName']) ctx._source['suggestionNames'] += ctx._source['prefName'].title; if (ctx._source['names']) { ctx._source['names'].each { ctx._source['suggestionNames'] += it.title; } } }",
				"lang": "groovy"
    		}
	    }
    }
}